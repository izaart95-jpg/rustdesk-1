  name: Minimal Remote Access

on:
  workflow_dispatch:

jobs:
  remote:
    runs-on: macos-latest
    timeout-minutes: 360

    steps:
      - name: Enable VNC
        run: |
          # ENABLE VNC - THAT'S IT
          sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart \
            -activate -configure -access -on -privs -all -restart -agent
          
          sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart \
            -configure -clientopts -setvnclegacy -vnclegacy yes -setvncpw myvncpassword
          
          echo "✅ VNC Enabled"
          echo "Password: myvncpassword"
          echo "Port: 5900"

      - name: Start Tailscale
        run: |
          brew install tailscale || true
          sudo brew services start tailscale 2>/dev/null || true
          sudo tailscale up --authkey tskey-auth-katBTfGaCP11CNTRL-hMqSUZh4fgPZNHebqNt7gPCxLc3sP2pf || true
          echo "Tailscale IP: $(tailscale ip --4 2>/dev/null | head -1)"

      - name: Run forever
        run: |
          TS_IP=$(tailscale ip --4 2>/dev/null | head -1)
          echo "========================================"
          echo "REMOTE ACCESS READY"
          echo "========================================"
          echo "VNC: $TS_IP:5900"
          echo "Password: myvncpassword"
          echo ""
          echo "⚠️ Use Apple-compatible VNC client!"
          echo "========================================"
          echo ""
          
          # Just keep it running
          while true; do
            sleep 60
            echo "[$(date)] Still running..."
          done
