name: Simple Click and Screenshot

on:
  workflow_dispatch:

jobs:
  click-test:
    runs-on: macos-latest
    timeout-minutes: 5

    steps:
      - name: Create Screenshot Directory
        run: |
          echo "=== Creating Screenshot Directory ==="
          mkdir -p screenshots
          echo "SCREENSHOT_DIR=$(pwd)/screenshots" >> $GITHUB_ENV

      - name: Install cliclick
        run: |
          echo "=== Installing cliclick ==="
          if ! command -v cliclick &> /dev/null; then
            brew install cliclick
          fi
          echo "âœ… cliclick installed"

      - name: Take Initial Screenshot
        run: |
          echo "=== Taking Initial Screenshot ==="
          timestamp=$(date +%Y%m%d_%H%M%S)
          screenshot_file="$SCREENSHOT_DIR/01_before_click_$timestamp.png"
          screencapture -x "$screenshot_file"
          echo "âœ… Initial screenshot saved: $screenshot_file"

      - name: Click at Coordinates (55, 725)
        run: |
          echo "=== Clicking at Coordinates (55, 725) ==="
          echo "Performing click at coordinates (55, 725)..."
          cliclick c:55,725
          echo "âœ… Click performed"
          
          # Wait for click to register
          sleep 1

      - name: Take Screenshot After Click
        run: |
          echo "=== Taking Screenshot After Click ==="
          timestamp=$(date +%Y%m%d_%H%M%S)
          screenshot_file="$SCREENSHOT_DIR/02_after_click_$timestamp.png"
          screencapture -x "$screenshot_file"
          echo "âœ… Screenshot after click saved: $screenshot_file"

      - name: Create Test Report
        run: |
          echo "=== Creating Test Report ==="
          INFO_FILE="$SCREENSHOT_DIR/test_report.txt"
          
          echo "Click Test Report" > "$INFO_FILE"
          echo "=================" >> "$INFO_FILE"
          echo "Test Date: $(date)" >> "$INFO_FILE"
          echo "macOS Version: $(sw_vers -productVersion)" >> "$INFO_FILE"
          echo "Click Coordinates: (55, 725)" >> "$INFO_FILE"
          echo "Screenshots Taken: 2" >> "$INFO_FILE"
          echo "" >> "$INFO_FILE"
          echo "Screenshot Files:" >> "$INFO_FILE"
          find "$SCREENSHOT_DIR" -name "*.png" -exec basename {} \; | sort >> "$INFO_FILE"
          
          echo "âœ… Test report saved"

      - name: Upload Screenshots
        uses: actions/upload-artifact@v4
        with:
          name: click-screenshots
          path: |
            ${{ env.SCREENSHOT_DIR }}
          retention-days: 7

      - name: Final Report
        run: |
          echo "=== Test Complete ==="
          echo ""
          echo "âœ… Click performed at coordinates (55, 725)"
          echo "âœ… 2 screenshots taken (before/after click)"
          echo "âœ… Screenshots uploaded as 'click-screenshots' artifact"
          echo ""
          echo "ðŸŽ¯ Test completed successfully!"
